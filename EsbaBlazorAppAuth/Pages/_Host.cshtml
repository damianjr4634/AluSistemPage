@page "/"
@namespace EsbaBlazorAppAuth.Pages
@using Microsoft.AspNetCore.Identity
@using Microsoft.Extensions.Configuration;

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@inject IConfiguration configuration
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager


@if (SignInManager.IsSignedIn(User))
{
    var user = await UserManager.GetUserAsync(User);
    if (user == null)
    {
        await SignInManager.SignOutAsync();
        Response.Redirect("/Identity/Account/Login");
    }
    else
    {
        Layout = null;

        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <title>EsbaBlazorAppAuth</title>
            <base href="~/" />
            <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
            <link href="css/site.css" rel="stylesheet" />
            <link href="EsbaBlazorAppAuth.styles.css" rel="stylesheet" />

             <!-- estilo del template de radzen, lo pongo antes para que no me altere boostrap -->
            <link href="_content/Radzen.Blazor/css/default.css" rel="stylesheet">
            <script src="_content/Radzen.Blazor/Radzen.Blazor.js"></script>

            <!-- jQuery -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

            <!-- Bootstrap -->
            <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
            <script src="js/bootstrap.bundle.min.js"></script>

            <!-- Font Awesome -->
            <link href="css/fontawesome-free-5.15.1/css/all.min.css" rel="stylesheet">

            <!-- https://github.com/Blazored/Toast -->
            <link href="_content/Blazored.Toast/blazored-toast.css" rel="stylesheet" />
        </head>
        <body>
            <component type="typeof(App)" render-mode="Server" />

            <div id="blazor-error-ui">
                <environment include="Staging,Production">
                    An error has occurred. This application may no longer respond until reloaded.
                </environment>
                <environment include="Development">
                    An unhandled exception has occurred. See browser dev tools for details.
                </environment>
                <a href="" class="reload">Reload</a>
                <a class="dismiss">🗙</a>
            </div>

            <script src="_framework/blazor.server.js"></script>
        </body>
        </html>
    }
}
else
{
    Response.Redirect("/Identity/Account/Login");
}
